# 07장 도커 컨포즈로 분산 애플리케이션 실행하기
- 도커 컴포즈를 사용하면 여러 컨테이너에 걸쳐 실행되는 애플리케이션(분산 컴포넌트)을 정의하고 관리할 수 있음

## 7.1 도커 컴포즈 파일의 구조
- Dockerfile 스크립트는 애플리케이션을 패키징하기 위한 스크립트임
- 다만, 분산 애플리케이션의 입장에서는 한 부분을 패키징하는 수단의 불가함
- 즉, 분산 애플리케이션을 구축할 때는 각 컴포넌트마다 별개로 일일이 수동으로 만들어주어야함. 이는 온갖 실수와 오류의 원천이 되기 쉬움
- 이를 해결하기 위해 도커 컴포즈 파일에 애플리케이션의 구조를 정의하여 관리하면 됨
- 도커 컴포즈 파일은 애플리케이션의 **`원하는 상태`** 를 기술하는 파일임
  - docker container run 명령으로 컨테이너를 실행할때 지정하는 모든 옵션을 한데 모아 놓은 단순한 형식의 파일임
- 도커 컴포즈 파일을 작성하고 나면, 도커 컴포즈 도구를 사용해 애플리케이션을 실행하게 됨
- 그러면, 도커 컴포즈가 컨테이너, 네트워크, 볼륨 등 필요한 모든 도커 객체를 만들도록 도커 API에 명령을 내림

- 예제

- 도커 컴포즈는 YAML 문법을 기술됨(따라서, 들여쓰기 중요함)
  - 도커 컴포즈는 다음 세개의 최상위 문으로 구성됨
    - version
    - service
    - networks

![CleanShot 2024-11-17 at 21 51 10@2x](https://github.com/user-attachments/assets/949cff32-2b74-48bc-9839-6e844f3a3644)

#### 도커 컴포즈 예제


- 도커 컴포즈 파일은 애플리케이션의 소스 코드, Dockerfile 스크립트와 함께 형상 관리 도구로 관리 가능
- 컴포즈 파일을 통해 설정 사항을 간접적으로 문서화하는 효과를 얻을 수 있음
  - 모든 실행 옵션이 기술되어 있기에 관리에 용이 

## 7.2 도커 컴포즈를 사용해 여러 컨테이너로 구성된 어플리케이션 실행하기
- 여러 개의 컨테이너로 구성된 이미지 갤러리를 기술항 컴포즈 스크립트

- `depends_on` 항목을 추가해 이 서비스는 다른 두 서비스에 의존한다는 사실도 기술할 수 있음

- 컴포즈 파일을 사용해 여러 개의 컨테이너로 구성된 애플리케이션을 마치 한 덩어리처럼 다룰 수 있게됨
- 이제 컴포즈가 나를 대신해 컨테이너를 관리해줌(쿠버네티스 처럼 세밀한 관리는 X)

- 다만, 도커 명령행으로 직접 어플리케이션을 수정하면, 애플리케이션이 컴포즈 파일에 기술된 구조와 불일치하게 만들 수 있음
- 도커 컴포즈는 YAML 파일에 정의된 애플리케이션 정의에 의존하는 클라이언트 측 도구임을 잊어서는 안됨
- 도커 엔진의 입장에서는 이들이 어떤 관계를 갖는지 알 수 없음

## 7.3 도커 컨테이너 간의 통신
- 컨테이너는 어떻게 서로 통신할까?
  - 컨테이너는 별도의 네트워크 공간을 가진 가상 환경임
  - 즉, 도커 엔진으로부터 부여받은 자신만의 가상 IP 주소를 가지며 모두 같은 도커 네트워크로 연결돼 이 IP 주소를 통해 서로 통신할 수 있음
- 그러나 IP 주소가 변경돼도 문제가 없도록 도커에서 DNS를 이용해 서비스 디스커버리 기능을 제공함
- 도커 DNS 서비스가 내장돼 있기 때문에 다른 구성 요소에 접근하기 위해 이 DNS 서비스를 사용함
- 컨테이너의 이름을 도메인 삼아 조회하면 해당 컨테이너의 IP 주소를 찾아줌
  - 이런 방법으로 도커 네트워크상에 있는 다른 컨테이너의 정보를 사용할 수 있음
  - 만약, 도메인이 가리키는 대상이 컨테이너가 아니면, 도커 엔진을 실행 중인 컴퓨터에 요청을 보내 호스트 컴퓨터가 속한 네트워크나 인터넷의 IP 주소를 조회함


- 도커 컴포즈는 이 점을 활용해 간단한 로드 밸런싱을 구현할 수 있음

## 7.4 도커 컴포즈로 애플리케이션 설정값 지정하기
- 패키징된 애플리케이션과 설정값을 분리할 수 있다는 것도 도커의 핵심적인 장점 중 하나
- 각 환경마다 컴포즈 파일에서 쉽게 정의할 수 있는 환경 변수나 바인드 마운트 설정, 비밀값 등으로 설정 값이 적용됨


## 7.5 도커 컴포즈도 만능은 아니다
- 도커 컴포즈는 복잡한 분산 애플리케이션의 설정을 짧고 명료한 포맷의 파일(YAML)로 나타낼 수 있게 해줌
- 다만, 쿠버네티스 처럼 완전한 컨테이너 플랫폼은 아님. 이들과 달리 지속적으로 정의된 상태를 유지하도록 하는 기능은 없음

- 도커 컴포즈를 사용하기 적합한 시기

  ![CleanShot 2024-11-17 at 22 15 40@2x](https://github.com/user-attachments/assets/22f85f95-6dac-4231-a4c6-317eae925743)


## 7.6 연습 문제
